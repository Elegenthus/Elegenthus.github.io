<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="generator" content="Hugo 0.15" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://Elegenthus.github.io/css/style.css" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
<link rel="alternate" href="https://Elegenthus.github.io/index.xml" type="application/rss+xml" title="Elegenthus&#39;s blog">
<title>VueDirectivesTest - Elegenthus&#39;s blog</title>
</head>
<body>

<header>
  <div class="container clearfix">
    <a class="path" href="https://elegenthus.github.io/">[Elegenthus&#39;s blog]</a>
    <span class="caret"># _ #</span>
    <div class="right">
      
    </div>
  </div>
</header>

<div class="container">


<main role="main" class="article">
  
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2016-11-20">November 20, 2016</time></span>



  </div>
  <h1 class="headline" itemprop="headline">VueDirectivesTest</h1>
  <section class="body" itemprop="articleBody">
    

<h2 id="使用vuedirective封装dom操作:8fb70ceb80e0e159e41b00203ce25900">使用VueDirective封装Dom操作</h2>

<p>这篇文章是关于Vue Directive的介绍，后面会介绍一个使用的小例子</p>

<p><em>1.为什么要使用VueDirective</em> <br><br>
Vue作为一个开发web的前端框架，以其轻量级和指令的丰富多样性而为大众所喜。然而，由于业务需求的不同，有时候我们也需要自己编写vue指令，在里面不可避免地会出现一些dom操作，为了实现View和ViewModel的分离，我们必须封装dom操作，于是我们需要VueDirective。 <br><br>
<em>2.VueDirective的简介</em> <br><br>
除了在相关组件中引入directive的指令之外，我们还需要在定义这个directive的操作，vue给我们提供了许多Hook Functions，以便于我们对directive的对象进行具体的操作。<br><br />
例如bind，bind是只会在被绑定的对象节点被插入父节点时被调用一次的函数，与unbind相对应，unbind将也只会在元素被解除绑定时调用。<br>
bind函数中会提供像el,binding,vnode,oldVnode这样一些形参，这里我们具体看一下binding<br><br>
binding是一个包含了众多性质的对象，关于它的所有的性质的介绍可以自行查看<a href="https://vuejs.org/v2/guide/custom-directive.html">官方文档</a> ,比较常用的一个属性binding.value，其对应的是在元素中被传给directive的值，vue会自动解析这个值并执行。与此相对应的另一个属性binding.expression里的值则不会被解析执行<br>
<br></p>

<p><em>3.怎样使用VueDirective</em> <br><br>
接下来我们来看一个具体使用VueDirective封装dom的scroll事件的例子，在这个例子中我们想要在用户滑动到页面的底端时发请求，请求下一个页面。<br>
1.首先我们需要一个包含dom操作的scroll.js <br></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">binding</span><span class="p">,</span> <span class="nx">vnode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;scroll&quot;</span><span class="p">,</span> <span class="nx">scrollCallback</span><span class="p">.</span><span class="nx">bind</span><span class="p">({},</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span>
    <span class="p">},</span>

    <span class="nx">unbind</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">&quot;scroll&quot;</span><span class="p">,</span> <span class="nx">scrollCallback</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>在这个scroll.js中我们需要监听页面的滚动，如果触发了scroll事件那么就要执行回调函数，在解除绑定的时候也要将监听事件从window上移除，所以我们必须给回调函数取一个名字scrollCallback，在unbind函数中将监听移除。但是由于我们还希望滑动到页面底端再发请求，也就是说不能马上执行binding.value，怎样实现这一点呢？我们把scrollCallback函数的具体内容写在对象外面，将bind.value作为函数的参数传进scrollCallback，在满足条件时调用binding.value <br>
2.在组件里import进这个directive <br></p>

<p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kr">import</span> <span class="nx">scrollDirective</span> <span class="nx">from</span> <span class="s1">&#39;../../directives/scroll&#39;</span>
</code></pre></div>
</p>

<p>使用import将directive引入组件 <br>
3.在组件的directives中注册scroll</p>

<p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">directives</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">scroll</span><span class="o">:</span> <span class="nx">scrollDirective</span>
<span class="p">},</span>
</code></pre></div>
</p>

<p>将引入的组件注册到scroll上 <br>
4.在元素上加上directive指令<br></p>

<p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">v</span><span class="o">-</span><span class="nx">scroll</span> <span class="o">=</span> <span class="s2">&quot;onScroll&quot;</span>
</code></pre></div>
</p>

<p>用注册好的名字在相对应的元素上加入指令 <br>
5.编写directive指令中的函数<br>
最后在method中编写onScroll函数，也就是上文中对应的binding.value，vue会执行相应v-scroll中的值。 <br></p>

  </section>
</article>

</main>


</div>

<footer>
  <div class="container">
    <span class="copyright">&copy; 2016  Elegenthus&#39;s blog - <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span>
  </div>
</footer>

</body>
</html>

